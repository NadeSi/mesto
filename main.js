(()=>{"use strict";function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var e=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this._baseUrl=t.baseUrl,this._authorization=t.headers.authorization}var n,r;return n=e,(r=[{key:"callApi",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return fetch("".concat(this._baseUrl).concat(t),e).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}},{key:"getInitialCards",value:function(){return this.callApi("/cards",{headers:{authorization:this._authorization}})}},{key:"addNewCard",value:function(t){var e=t.name,n=t.link;return this.callApi("/cards",{method:"POST",headers:{authorization:this._authorization,"Content-Type":"application/json"},body:JSON.stringify({name:e,link:n})})}},{key:"deleteCard",value:function(t){return this.callApi("/cards/".concat(t),{method:"DELETE",headers:{authorization:this._authorization}})}},{key:"addLikeCard",value:function(t){return this.callApi("/cards/likes/".concat(t),{method:"PUT",headers:{authorization:this._authorization,"Content-Type":"application/json"}})}},{key:"deleteLikeCard",value:function(t){return this.callApi("/cards/likes/".concat(t),{method:"DELETE",headers:{authorization:this._authorization,"Content-Type":"application/json"}})}},{key:"getUserInfo",value:function(){return this.callApi("/users/me",{headers:{authorization:this._authorization}})}},{key:"setUserInfo",value:function(t){var e=t.name,n=t.about;return this.callApi("/users/me",{method:"PATCH",headers:{authorization:this._authorization,"Content-Type":"application/json"},body:JSON.stringify({name:e,about:n})})}},{key:"setUserAvatar",value:function(t){return this.callApi("/users/me/avatar",{method:"PATCH",headers:{authorization:this._authorization,"Content-Type":"application/json"},body:JSON.stringify({avatar:t})})}}])&&t(n.prototype,r),e}();function n(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var r=function(){function t(e,n){var r=e.renderer;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._renderer=r,this._container=document.querySelector(n)}var e,r;return e=t,(r=[{key:"addItem",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e?this._container.append(t):this._container.prepend(t)}},{key:"renderItems",value:function(t){var e=this;t&&t.forEach((function(t){e._renderer(t)}))}}])&&n(e.prototype,r),t}();function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var o=function(){function t(e){var n=e.userNameSelector,r=e.userDescriptionSelector,i=e.userAvatarId;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._name=document.querySelector(n),this._description=document.querySelector(r),this._avatar=document.getElementById(i)}var e,n;return e=t,(n=[{key:"getUserInfo",value:function(){return{userName:this._name.textContent,userDescription:this._description.textContent}}},{key:"getUserId",value:function(){return this._id}},{key:"setUserInfo",value:function(t){var e=t.userName,n=t.userDescription,r=t.userAvatarUrl,i=t._id;this._name.textContent=e,this._description.textContent=n,this._avatar.style.backgroundImage="url('".concat(r,"')"),this._id=i}}])&&i(e.prototype,n),t}();function a(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var u=function(){function t(e,n,r,i,o,a){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._cardSelector=n,this._id=e._id,this._text=e.name,this._imgUrl=e.link,this._likes=e.likes,this._owner=e.owner,this._handleCardClick=r.bind(this),this._handleCardDelete=i.bind(this),this._handleCardLike=o.bind(this),this._handleCardLikeDelete=a.bind(this),this._handleLikeClick=this._handleLikeClick.bind(this),this._handleDeleteBtnClick=this._handleDeleteBtnClick.bind(this)}var e,n;return e=t,(n=[{key:"_handleLikeClick",value:function(){var t=this,e=function(e){n.classList.toggle("element__like_active"),t._likes=e.likes,t._element.querySelector(".element__like-count").textContent=t._likes.length},n=this._element.querySelector(".element__like");n.classList.contains("element__like_active")?this._handleCardLikeDelete(this._id,e):this._handleCardLike(this._id,e)}},{key:"_handleDeleteBtnClick",value:function(){this._element.remove(),this._element=null}},{key:"_getTemplate",value:function(){return document.querySelector(this._cardSelector).content.querySelector(".element").cloneNode(!0)}},{key:"generateCard",value:function(t){var e=this;if(this._element=this._getTemplate(),this._imgUrl){var n=this._element.querySelector(".element__img");n.src=this._imgUrl,n.alt=this._text,n.addEventListener("click",this._handleCardClick)}if(this._likes&&(this._element.querySelector(".element__like-count").textContent=this._likes.length,0!==this._likes.filter((function(e){return e._id===t})).length&&this._element.querySelector(".element__like").classList.toggle("element__like_active")),this._element.querySelector(".element__text").textContent=this._text,this._element.querySelector(".element__like").addEventListener("click",this._handleLikeClick),this._owner&&this._owner._id===t){var r=this._element.querySelector(".element__delete-card");r.classList.add("element__delete-card_visible"),r.addEventListener("click",(function(){return e._handleCardDelete(e._id,e._handleDeleteBtnClick)}))}return this._element}}])&&a(e.prototype,n),t}();function c(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var l=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._formElement=document.querySelector(n),this._inputList=Array.from(this._formElement.querySelectorAll(this._inputSelector))}var e,n;return e=t,(n=[{key:"_hasInvalidInput",value:function(){return this._inputList.some((function(t){return!t.validity.valid}))}},{key:"_showInputError",value:function(t){var e=this._formElement.querySelector("#".concat(t.name,"-error"));t.classList.add(this._inputErrorClass),e.textContent=t.validationMessage,e.classList.add(this._errorClass)}},{key:"_hideInputError",value:function(t){var e=this._formElement.querySelector("#".concat(t.name,"-error"));t.classList.remove(this._inputErrorClass),e.classList.remove(this._errorClass),e.textContent=""}},{key:"_checkInputValidity",value:function(t){t.validity.valid?this._hideInputError(t):this._showInputError(t)}},{key:"_inputElementHandler",value:function(t){this._checkInputValidity(t),this.toggleButtonState()}},{key:"_setEventListeners",value:function(){var t=this;this._buttonElement=this._formElement.querySelector(this._submitButtonSelector),this.toggleButtonState(),this._inputList.forEach((function(e){e.addEventListener("input",(function(){t._inputElementHandler(e)}))}))}},{key:"toggleButtonState",value:function(){this._hasInvalidInput()?(this._buttonElement.setAttribute("disabled",!0),this._buttonElement.classList.add(this._inactiveButtonClass)):(this._buttonElement.removeAttribute("disabled"),this._buttonElement.classList.remove(this._inactiveButtonClass))}},{key:"cleanInputs",value:function(){var t=this;this._inputList.forEach((function(e){e.value="",t._hideInputError(e)}))}},{key:"enableValidation",value:function(){this._setEventListeners()}}])&&c(e.prototype,n),t}();function s(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var f=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._popupElement=document.querySelector(e),this._buttonClosePopup=this._popupElement.querySelector(".button_type_close")}var e,n;return e=t,(n=[{key:"_handleEscClose",value:function(t){"Escape"===t.key&&this.close()}},{key:"_handleMisclick",value:function(t){t.target===this._popupElement&&this.close()}},{key:"setEventListeners",value:function(){this._popupElement.addEventListener("click",this._handleMisclick.bind(this)),this._buttonClosePopup.addEventListener("click",this.close.bind(this))}},{key:"open",value:function(){this._popupElement.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose.bind(this))}},{key:"close",value:function(){document.removeEventListener("keydown",this._handleEscClose.bind(this)),this._popupElement.classList.remove("popup_opened")}}])&&s(e.prototype,n),t}();function p(t){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function d(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function y(t,e,n){return(y="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=m(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function _(t,e){return(_=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function v(t,e){return!e||"object"!==p(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function m(t){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var b=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_(t,e)}(a,t);var e,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=m(r);if(i){var n=m(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return v(this,t)});function a(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(n=o.call(this,t))._submitCallBack=e,n._inputList=Array.from(n._popupElement.querySelectorAll(".popup__input")),n._buttonSubmit=n._popupElement.querySelector(".button_type_submit"),n}return e=a,(n=[{key:"setSubmitButtonText",value:function(t){this._buttonSubmit.textContent=t}},{key:"setInputValues",value:function(t){for(var e=this,n=function(){var t,n,o=(t=i[r],n=2,function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],r=!0,i=!1,o=void 0;try{for(var a,u=t[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==u.return||u.return()}finally{if(i)throw o}}return n}}(t,n)||function(t,e){if(t){if("string"==typeof t)return h(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(t,e):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=o[0],u=o[1],c=e._inputList.filter((function(t){return t.name===a}))[0];c&&(c.value=u)},r=0,i=Object.entries(t);r<i.length;r++)n()}},{key:"_getInputValues",value:function(){var t={};return this._inputList.forEach((function(e){t[e.name]=e.value})),t}},{key:"setEventListeners",value:function(){var t=this;y(m(a.prototype),"setEventListeners",this).call(this),this._popupElement.addEventListener("submit",(function(e){e.preventDefault(),t._submitCallBack(e,t._getInputValues())}))}}])&&d(e.prototype,n),a}(f);function k(t){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function g(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function E(t,e,n){return(E="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=w(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function S(t,e){return(S=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function C(t,e){return!e||"object"!==k(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function w(t){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var L=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&S(t,e)}(a,t);var e,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=w(r);if(i){var n=w(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return C(this,t)});function a(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),o.call(this,t)}return e=a,(n=[{key:"open",value:function(t){var e=t.text,n=t.imgUrl,r=this._popupElement.querySelector(".view-card__img");r.src=n,r.alt=e,this._popupElement.querySelector(".view-card__text").textContent=e,E(w(a.prototype),"open",this).call(this)}}])&&g(e.prototype,n),a}(f);function O(t){return(O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function j(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function I(t,e,n){return(I="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=T(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function P(t,e){return(P=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function B(t,e){return!e||"object"!==O(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function T(t){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var x,A,q=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&P(t,e)}(a,t);var e,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=T(r);if(i){var n=T(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return B(this,t)});function a(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),o.call(this,t)}return e=a,(n=[{key:"setSubmitCallBack",value:function(t){this._submitCallBack=t}},{key:"setEventListeners",value:function(){var t=this;I(T(a.prototype),"setEventListeners",this).call(this),this._popupElement.addEventListener("submit",(function(e){e.preventDefault(),t._submitCallBack()}))}},{key:"close",value:function(){this._submitCallBack=null,I(T(a.prototype),"close",this).call(this)}}])&&j(e.prototype,n),a}(f),D="https://mesto.nomoreparties.co/v1/".concat("cohort-18"),R="#template-card",U={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".button_type_submit",inactiveButtonClass:"button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},z=new e({baseUrl:D,headers:{authorization:"5047ac00-a9f0-4a5a-a356-7a06cbbe356a","Content-Type":"application/json"}}),N=document.querySelector(".button_type_edit-avatar"),V=document.querySelector(".button_type_edit"),H=document.querySelector(".button_type_add"),M=new b(".popup_type_edit-avatar",(function(t,e){M.setSubmitButtonText("Сохранение..."),z.setUserAvatar(e["edit-avatar-url"]).then((function(t){tt(t),M.close()})).catch((function(t){Z(t)})).finally((function(){M.setSubmitButtonText("Сохранить")}))})),J=new b(".popup_type_edit-profile",(function(t,e){J.setSubmitButtonText("Сохранение..."),z.setUserInfo({name:e["edit-profile-name"],about:e["edit-profile-description"]}).then((function(t){tt(t),J.close()})).catch((function(t){Z(t)})).finally((function(){J.setSubmitButtonText("Сохранить")}))})),$=new b(".popup_type_add-card",(function(t,e){$.setSubmitButtonText("Сохранение..."),z.addNewCard({name:e["add-card-name"],link:e["add-card-url"]}).then((function(t){nt(t),$.close()})).catch((function(t){Z(t)})).finally((function(){$.setSubmitButtonText("Создать")}))})),F=new L(".popup_type_view-card"),G=new q(".popup_type_delete-card",et),K=new l(U,"#popup-edit-avatar"),Q=new l(U,"#popup-edit-profile"),W=new l(U,"#popup-add-card"),X=new o({userNameSelector:".profile__name",userDescriptionSelector:".profile__description",userAvatarId:"profile__avatar"}),Y=new r({items:[],renderer:function(t){nt(t,!0)}},".elements"),Z=function(t){console.log(t)};function tt(t){var e=t.name,n=t.about,r=t.avatar,i=t._id;X.setUserInfo({userName:e,userDescription:n,userAvatarUrl:r,_id:i})}function et(t,e){z.deleteCard(t).then((function(t){console.log(t),e(),G.close()})).catch((function(t){Z(t)}))}function nt(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=new u(t,R,(function(){F.open({text:t.name,imgUrl:t.link})}),(function(t,e){G.setSubmitCallBack((function(){return et(t,e)})),G.open()}),(function(t,e){z.addLikeCard(t).then((function(t){e(t)})).catch((function(t){Z(t)}))}),(function(t,e){z.deleteLikeCard(t).then((function(t){e(t)})).catch((function(t){Z(t)}))}));Y.addItem(n.generateCard(X.getUserId()),e)}function rt(){K.cleanInputs(),K.toggleButtonState(),M.open()}function it(){var t,e,n,r;Q.cleanInputs(),e=(t=X.getUserInfo()).userName,n=t.userDescription,(r={})["edit-profile-name"]=e,r["edit-profile-description"]=n,J.setInputValues(r),Q.toggleButtonState(),J.open()}function ot(){W.cleanInputs(),W.toggleButtonState(),$.open()}x=z.getInitialCards(),A=z.getUserInfo(),Promise.all([x,A]).then((function(t){var e=t[0];tt(t[1]),Y.renderItems(e),M.setEventListeners(),J.setEventListeners(),$.setEventListeners(),F.setEventListeners(),G.setEventListeners(),N.addEventListener("click",rt),V.addEventListener("click",it),H.addEventListener("click",ot),K.enableValidation(),Q.enableValidation(),W.enableValidation()})).catch((function(t){Z(t)}))})();